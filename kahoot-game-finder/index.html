<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kahoot Scanner</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { color: #2c3e50; }
    #found { margin-top: 20px; }
    .code { display: inline-block; margin: 2px 4px; font-weight: bold; opacity: 1; transition: opacity 5s linear; }
    .new { color: green; }
</style>
</head>
<body>
<h1>Kahoot Scanner</h1>
<p>Codes checked: <span id="checked">0</span></p>
<p>Codes found: <span id="found-count">0</span></p>

<div id="found"></div>

<h3>Skipped counts:</h3>
<ul>
    <li>Old games: <span id="old">0</span></li>
    <li>No session: <span id="no_session">0</span></li>
    <li>Locked: <span id="locked">0</span></li>
    <li>Other: <span id="other">0</span></li>
</ul>

<script>
const foundDiv = document.getElementById('found');
let allCodes = new Set();

async function updateStatus() {
    const res = await fetch('/status');
    const data = await res.json();

    document.getElementById('checked').textContent = data.codes_checked;
    document.getElementById('found-count').textContent = data.codes_found.length;

    // Add new codes
    data.new_codes.forEach(code => {
        if (!allCodes.has(code)) {
            const span = document.createElement('span');
            span.textContent = code;
            span.classList.add('code', 'new');
            foundDiv.appendChild(span);
            allCodes.add(code);

            // Fade out after 10 seconds
            setTimeout(() => {
                span.style.opacity = 0;
            }, 10000);

            // Remove from DOM after fade
            setTimeout(() => {
                span.remove();
                allCodes.delete(code);
            }, 15000);
        }
    });

    document.getElementById('old').textContent = data.codes_skipped.old;
    document.getElementById('no_session').textContent = data.codes_skipped.no_session;
    document.getElementById('locked').textContent = data.codes_skipped.locked;
    document.getElementById('other').textContent = data.codes_skipped.other;
}

// Update every second
setInterval(updateStatus, 1000);
updateStatus();
</script>
</body>
</html>
