<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kahoot Terminal</title>
<style>
body {
    background: #0f0f0f;
    color: #00ff00;
    font-family: monospace;
    padding: 20px;
    margin: 0;
}
#terminal {
    white-space: pre-wrap;
    font-size: 16px;
    line-height: 1.3;
    height: 90vh;
    overflow-y: auto;
}
.pin {
    font-size: 2.5em;
    font-weight: bold;
    color: #ff0;
}
</style>
</head>
<body>
<h1>Kahoot Code Scanner Terminal</h1>
<div id="terminal">Connecting to scanner...\nPress Ctrl+C to stop.\n\n</div>

<script>
const terminal = document.getElementById("terminal");
let stopScanner = false;

// Ctrl+C stops the scanner
document.addEventListener("keydown", (e) => {
    if (e.ctrlKey && e.key.toLowerCase() === "c") {
        stopScanner = true;
        terminal.innerHTML += "\nStopped by user.";
        if (evtSource) evtSource.close();
    }
});

function printToTerminal(text, isPin=false) {
    if (isPin) {
        terminal.innerHTML += "\n==============================\n";
        terminal.innerHTML += `<span class="pin">ðŸŽ¯ ${text}</span>\n`;
        terminal.innerHTML += "==============================\n";
    } else {
        terminal.innerHTML += text + "\n";
    }
    terminal.scrollTop = terminal.scrollHeight;
}

// Connect to Render backend using EventSource
const evtSource = new EventSource("https://your-render-app.onrender.com/scan");

evtSource.onmessage = function(event) {
    if (stopScanner) return;
    const msg = event.data;
    if (msg.startsWith("ACTIVE")) {
        printToTerminal(msg.split(" ")[1], true);
    } else {
        printToTerminal(msg);
    }
};

evtSource.onerror = function() {
    printToTerminal("Connection lost. Refresh page to reconnect.");
};
</script>
</body>
</html>
